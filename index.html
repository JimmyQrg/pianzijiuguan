<!DOCTYPE html>
<html lang="zh">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Liar Tavern - Gun Simulator</title>

<style>
body {
  margin: 0;
  height: 100vh;
  font-family: "Press Start 2P", monospace;
  color: #eee;
  background: radial-gradient(ellipse at center, #2b1b10 0%, #0d0704 100%);
  display: flex;
  flex-direction: column;
  justify-content: center;
  align-items: center;
  overflow: hidden;
}

/* 酒馆雾气 */
.smoke {
  position: absolute;
  top: 0; left: 0;
  width: 100%; height: 100%;
  background: radial-gradient(circle, rgba(255,255,255,0.04) 0%, rgba(0,0,0,0.05) 70%);
  animation: fogMove 30s infinite alternate ease-in-out;
  pointer-events: none;
}
@keyframes fogMove {
  from { transform: translate(-20px, -10px); }
  to { transform: translate(20px, 10px); }
}

/* 闪烁灯光 */
@keyframes lightFlicker {
  0%, 100% { opacity: 1; }
  50% { opacity: 0.95; }
  80% { opacity: 0.9; }
}
body::before {
  content: "";
  position: absolute;
  top: 0; left: 0;
  width: 100%; height: 100%;
  background: radial-gradient(circle at 50% 30%, rgba(255,235,180,0.15), transparent 70%);
  animation: lightFlicker 6s infinite;
  pointer-events: none;
}

/* 转轮与按钮区 */
.revolver {
  position: relative;
  width: 200px;
  height: 200px;
  border-radius: 50%;
  background: radial-gradient(circle, #444 0%, #222 80%);
  box-shadow: 0 0 20px rgba(0,0,0,0.7), inset 0 0 10px #000;
  display: flex;
  justify-content: center;
  align-items: center;
  margin-bottom: 40px;
}
.chamber {
  width: 40px;
  height: 40px;
  border-radius: 50%;
  background: #1a1a1a;
  box-shadow: inset 0 0 5px #000;
  position: absolute;
}
.chamber:nth-child(1) { transform: rotate(0deg) translateY(-70px); }
.chamber:nth-child(2) { transform: rotate(60deg) translateY(-70px); }
.chamber:nth-child(3) { transform: rotate(120deg) translateY(-70px); }
.chamber:nth-child(4) { transform: rotate(180deg) translateY(-70px); }
.chamber:nth-child(5) { transform: rotate(240deg) translateY(-70px); }
.chamber:nth-child(6) { transform: rotate(300deg) translateY(-70px); }

button {
  background: #3c2b20;
  color: #f8e4b1;
  border: 2px solid #6d4c33;
  border-radius: 10px;
  padding: 10px 20px;
  font-size: 14px;
  cursor: pointer;
  box-shadow: 0 4px #2a1c12;
  transition: all 0.15s;
  margin: 5px;
}
button:hover {
  background: #5a3e2b;
}
button:active {
  transform: translateY(2px);
  box-shadow: 0 2px #2a1c12;
}

#playerCountInput {
  background: #2a1c12;
  color: #f8e4b1;
  border: 2px solid #6d4c33;
  border-radius: 6px;
  padding: 5px 8px;
  text-align: center;
  width: 80px;
  font-size: 12px;
  margin-bottom: 10px;
}
#info {
  margin-top: 10px;
  color: #c0a889;
  font-size: 12px;
}
</style>
</head>

<body>
<div class="smoke"></div>

<h2 style="color:#f1d9b2;text-shadow:0 0 10px #000;">Liar Tavern - Gun Simulator</h2>

<input id="playerCountInput" type="number" placeholder="Player Amount (1~100)" min="1" max="100" value="1">
<button onclick="buttonClick(); setPlayers()">Set Player Amount</button>

<div class="revolver" id="revolver"></div>
<button onclick="buttonClick(); shoot()">开枪</button>
<div id="info">Wait for filling the bullets...</div>

<audio id="emptySound" src="empty.mp3"></audio>
<audio id="popSound" src="pop.mp3"></audio>
<audio id="bgMusic" src="background-music.mp3" loop></audio>
<audio id="tapSound" src="tap.mp3"></audio>

<script>
const revolver = document.getElementById("revolver");
const info = document.getElementById("info");
const emptySound = document.getElementById("emptySound");
const popSound = document.getElementById("popSound");
const bgMusic = document.getElementById("bgMusic");
const tapSound = document.getElementById("tapSound");
bgMusic.volume = 0.4;

let players = 1;
let currentPlayer = 0;
let chambers = [];
let currentChamberIndex = [];
let bgStarted = false;

// 枪膛
for (let i=0; i<6; i++) {
  const c = document.createElement("div");
  c.classList.add("chamber");
  revolver.appendChild(c);
}

// 点击按钮统一音效
function buttonClick() {
  tapSound.currentTime = 0;
  tapSound.play();

  // 用户第一次点击时启动背景音乐
  if (!bgStarted) {
    bgMusic.play().catch(()=>{});
    bgStarted = true;
  }
}

// 设置玩家数并装弹
function setPlayers() {
  const val = parseInt(document.getElementById("playerCountInput").value);
  if (isNaN(val) || val < 1 || val > 100) {
    alert("The player amount has to be between 1 and 100.");
    return;
  }
  players = val;
  currentPlayer = 0;
  chambers = [];
  currentChamberIndex = [];
  for (let i=0; i<players; i++) {
    const bulletPos = Math.floor(Math.random() * 6);
    chambers.push(bulletPos);
    currentChamberIndex.push(0);
  }
  info.textContent = `Bullet filled, currect player: 1 / ${players}`;
}

// 开枪逻辑
function shoot() {
  if (chambers.length === 0) {
    info.textContent = "Please set the player amount first.";
    return;
  }

  const player = currentPlayer;
  const index = currentChamberIndex[player];
  const bulletPos = chambers[player];

  if (index === bulletPos) {
    popSound.currentTime = 0;
    popSound.play();
    info.textContent = `Player ${player+1} fires! Blood exploded out from the player's head in all directions.!`;
  } else {
    emptySound.currentTime = 0;
    emptySound.play();
    info.textContent = `Player ${player+1} Fires! Nothing happened. The player breaths heavily`;
  }

  currentChamberIndex[player] = (index + 1) % 6;
  currentPlayer = (currentPlayer + 1) % players;
  info.textContent += ` → Next Player: ${currentPlayer+1}`;
}
</script>
</body>
</html>
