<!DOCTYPE html>
<html lang="zh">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>骗子酒馆左轮手枪模拟器</title>

<style>
body {
  margin: 0;
  height: 100vh;
  font-family: "Press Start 2P", monospace;
  color: #eee;
  background: radial-gradient(ellipse at center, #2b1b10 0%, #0d0704 100%);
  display: flex;
  flex-direction: column;
  justify-content: center;
  align-items: center;
  overflow: hidden;
  transition: background 1s ease;
}

/* 红色闪光 */
body.shoot-red {
  background: radial-gradient(ellipse at center, #4a0000 0%, #0d0000 100%) !important;
}

/* 雾气 */
.smoke {
  position: absolute;
  top: 0; left: 0;
  width: 100%; height: 100%;
  background: radial-gradient(circle, rgba(255,255,255,0.04) 0%, rgba(0,0,0,0.05) 70%);
  animation: fogMove 30s infinite alternate ease-in-out;
  pointer-events: none;
}
@keyframes fogMove {
  from { transform: translate(-20px, -10px); }
  to { transform: translate(20px, 10px); }
}

/* 闪烁灯光 */
@keyframes lightFlicker {
  0%, 100% { opacity: 1; }
  50% { opacity: 0.95; }
  80% { opacity: 0.9; }
}
body::before {
  content: "";
  position: absolute;
  top: 0; left: 0;
  width: 100%; height: 100%;
  background: radial-gradient(circle at 50% 30%, rgba(255,235,180,0.15), transparent 70%);
  animation: lightFlicker 6s infinite;
  pointer-events: none;
}

/* 转轮 */
.revolver {
  position: relative;
  width: 200px;
  height: 200px;
  border-radius: 50%;
  background: radial-gradient(circle, #444 0%, #222 80%);
  box-shadow: 0 0 20px rgba(0,0,0,0.7), inset 0 0 10px #000;
  display: flex;
  justify-content: center;
  align-items: center;
  margin-bottom: 40px;
  transition: transform 0.6s ease;
}
.chamber {
  width: 40px;
  height: 40px;
  border-radius: 50%;
  background: #1a1a1a;
  box-shadow: inset 0 0 5px #000;
  position: absolute;
}
.chamber:nth-child(1) { transform: rotate(0deg) translateY(-70px); }
.chamber:nth-child(2) { transform: rotate(60deg) translateY(-70px); }
.chamber:nth-child(3) { transform: rotate(120deg) translateY(-70px); }
.chamber:nth-child(4) { transform: rotate(180deg) translateY(-70px); }
.chamber:nth-child(5) { transform: rotate(240deg) translateY(-70px); }
.chamber:nth-child(6) { transform: rotate(300deg) translateY(-70px); }

/* 按钮样式 */
button {
  background: #3c2b20;
  color: #f8e4b1;
  border: 2px solid #6d4c33;
  border-radius: 10px;
  padding: 10px 20px;
  font-size: 14px;
  cursor: pointer;
  box-shadow: 0 4px #2a1c12;
  transition: all 0.15s;
  margin: 5px;
}
button:hover { background: #5a3e2b; }
button:active { transform: translateY(2px); box-shadow: 0 2px #2a1c12; }

#playerCountInput {
  background: #2a1c12;
  color: #f8e4b1;
  border: 2px solid #6d4c33;
  border-radius: 6px;
  padding: 5px 8px;
  text-align: center;
  width: 80px;
  font-size: 12px;
  margin-bottom: 10px;
}

#info {
  margin-top: 10px;
  color: #c0a889;
  font-size: 12px;
}

#shotCount {
  margin-top: 20px;
  color: #ff4c4c;
  font-size: 12px;
}
</style>
</head>

<body>
<div class="smoke"></div>

<h2 style="color:#f1d9b2;text-shadow:0 0 10px #000;">骗子酒馆左轮手枪</h2>

<input id="playerCountInput" type="number" placeholder="玩家数 (1~100)" min="1" max="100" value="1">
<button onclick="buttonClick(); setPlayers()">设定玩家数量</button>

<div class="revolver" id="revolver"></div>
<button onclick="buttonClick(); shoot()">开枪</button>

<div id="info">等待装弹...</div>
<div id="shotCount"></div>

<audio id="emptySound" src="empty.mp3"></audio>
<audio id="popSound" src="pop.mp3"></audio>
<audio id="tapSound" src="tap.mp3"></audio>
<audio id="bgMusic" src="background-music.mp3" loop></audio>

<script>
const revolver = document.getElementById("revolver");
const info = document.getElementById("info");
const shotCountDisplay = document.getElementById("shotCount");
const emptySound = document.getElementById("emptySound");
const popSound = document.getElementById("popSound");
const tapSound = document.getElementById("tapSound");
const bgMusic = document.getElementById("bgMusic");
bgMusic.volume = 0.4;

let players = 1;
let currentPlayer = 0;
let chambers = [];
let currentChamberIndex = [];
let playerAlive = [];
let playerShots = [];
let bgStarted = false;

// 初始化枪膛
for (let i=0; i<6; i++) {
  const c = document.createElement("div");
  c.classList.add("chamber");
  revolver.appendChild(c);
}

// 统一按钮点击音效与音乐启动
function buttonClick() {
  tapSound.currentTime = 0;
  tapSound.play();
  if (!bgStarted) {
    bgMusic.play().catch(()=>{});
    bgStarted = true;
  }
}

// 设置玩家数并装弹
function setPlayers() {
  const val = parseInt(document.getElementById("playerCountInput").value);
  if (isNaN(val) || val < 1 || val > 100) {
    alert("玩家数量必须在 1~100 之间。");
    return;
  }
  players = val;
  currentPlayer = 0;
  chambers = [];
  currentChamberIndex = [];
  playerAlive = [];
  playerShots = [];
  for (let i=0; i<players; i++) {
    chambers.push(Math.floor(Math.random() * 6));
    currentChamberIndex.push(0);
    playerAlive.push(true);
    playerShots.push(0);
  }
  info.textContent = `已装弹。当前玩家: 1 / ${players}`;
  shotCountDisplay.textContent = "0/6";
}

// 找下一个活着的玩家
function nextAlivePlayer() {
  for (let i = 1; i <= players; i++) {
    const next = (currentPlayer + i) % players;
    if (playerAlive[next]) return next;
  }
  return -1;
}

// 转轮动画
function spinRevolver() {
  revolver.style.transform = "rotate(0deg)";
  setTimeout(() => {
    revolver.style.transform = "rotate(360deg)";
  }, 10);
}

// 开枪逻辑
function shoot() {
  if (chambers.length === 0) {
    info.textContent = "请先设定玩家数量。";
    return;
  }

  // 找当前玩家
  if (!playerAlive[currentPlayer]) {
    currentPlayer = nextAlivePlayer();
    if (currentPlayer === -1) {
      info.textContent = "所有玩家阵亡。";
      return;
    }
  }

  const player = currentPlayer;
  const index = currentChamberIndex[player];
  const bulletPos = chambers[player];

  spinRevolver();

  playerShots[player]++;
  shotCountDisplay.textContent = `${playerShots[player]}/6`;

  setTimeout(() => {
    if (index === bulletPos) {
      popSound.currentTime = 0;
      popSound.play();
      playerAlive[player] = false;
      document.body.classList.add("shoot-red");
      setTimeout(() => document.body.classList.remove("shoot-red"), 1000);
      info.textContent = `玩家 ${player+1} 开枪！中弹！`;
    } else {
      emptySound.currentTime = 0;
      emptySound.play();
      info.textContent = `玩家 ${player+1} 安然无事。`;
    }

    currentChamberIndex[player] = (index + 1) % 6;

    const next = nextAlivePlayer();
    if (next === -1) {
      info.textContent += " 所有玩家阵亡。";
    } else {
      currentPlayer = next;
      info.textContent += ` → 下一个玩家: ${currentPlayer+1}`;
    }
  }, 500);
}
</script>
</body>
</html>
